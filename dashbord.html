<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC-Shop Admin Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #dc0a2d;
            --dark-color: #1c1c25;
            --light-color: #f8f9fa;
        }
        
        body {
            background-color: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .sidebar {
            background-color: var(--dark-color);
            color: white;
            height: 100vh;
            position: fixed;
            padding-top: 20px;
        }
        
        .sidebar .nav-link {
            color: #ccc;
            padding: 12px 20px;
            margin-bottom: 5px;
            border-left: 4px solid transparent;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255,255,255,0.05);
            color: white;
            border-left: 4px solid var(--primary-color);
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .brand {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: bold;
            padding: 10px 20px;
            margin-bottom: 20px;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        
        .top-bar {
            background-color: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .stats-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            color: white;
        }
        
        .bg-primary-soft {
            background-color: var(--primary-color);
        }
        
        .bg-info-soft {
            background-color: #0dcaf0;
        }
        
        .bg-success-soft {
            background-color: #198754;
        }
        
        .bg-warning-soft {
            background-color: #ffc107;
        }
        
        .stats-info h5 {
            margin-bottom: 5px;
            font-weight: 700;
            font-size: 22px;
        }
        
        .stats-info span {
            color: #6c757d;
            font-size: 14px;
        }
        
        .table thead th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #c0001d;
            border-color: #c0001d;
        }
        
        .user-action a {
            padding: 5px;
            font-size: 14px;
        }
        
        .badge-status {
            padding: 5px 10px;
            border-radius: 30px;
            font-weight: normal;
        }
        
        .pagination {
            margin-bottom: 0;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .avatar-col {
            width: 60px;
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-header .btn-close {
            color: white;
            background: none;
            opacity: 1;
        }
        
        .user-detail {
            display: flex;
            align-items: center;
        }
        
        .user-detail img {
            margin-right: 10px;
        }
        
        /* Product List Styles */
        .product-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: box-shadow 0.2s;
        }

        .product-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .product-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .product-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        .product-detail {
            font-size: 14px;
            color: #666;
        }

        .product-detail strong {
            color: #333;
        }

        .price-section {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 10px;
        }

        .price {
            font-weight: bold;
        }

        .final-price {
            color: var(--primary-color);
            font-size: 18px;
        }

        .sales-price {
            color: #666;
            text-decoration: line-through;
        }

        .discount-price {
            color: #28a745;
        }

        .rating {
            color: #ffc107;
            font-weight: bold;
        }

        .search-box input {
            border-radius: 6px;
            border: 1px solid #ced4da;
            padding: 10px 12px;
            font-size: 14px;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(220, 10, 45, 0.25);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar col-md-3 col-lg-2 d-md-block">
        <div class="brand">PC-Shop</div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a href="#dashboard" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="#users" class="nav-link" data-page="users">
                    <i class="fas fa-users"></i> User Management
                </a>
            </li>
            <li class="nav-item">
                <a href="#products" class="nav-link" data-page="products">
                    <i class="fas fa-box"></i> Products
                </a>
            </li>
            <li class="nav-item">
                <a href="#categories" class="nav-link" data-page="categories">
                    <i class="fas fa-tags"></i> Categories
                </a>
            </li>
            <li class="nav-item">
                <a href="#orders" class="nav-link" data-page="orders">
                    <i class="fas fa-shopping-cart"></i> Orders
                </a>
            </li>
            <li class="nav-item">
                <a href="#reports" class="nav-link" data-page="reports">
                    <i class="fas fa-chart-bar"></i> Reports
                </a>
            </li>
            <li class="nav-item">
                <a href="#settings" class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </li>
            <li class="nav-item mt-5">
                <a href="#logout" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div>
                <h4 class="mb-0">Admin Dashboard</h4>
            </div>
            <div class="d-flex align-items-center">
                <div class="dropdown me-3">
                    <a href="#" class="position-relative text-dark" data-bs-toggle="dropdown">
                        <i class="fas fa-bell fa-lg"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            3
                        </span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">New order received</a></li>
                        <li><a class="dropdown-item" href="#">New user registered</a></li>
                        <li><a class="dropdown-item" href="#">Low stock alert</a></li>
                    </ul>
                </div>
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="/api/placeholder/40/40" alt="Admin" class="rounded-circle me-2" width="32" height="32">
                        <span>Admin</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end text-small shadow" aria-labelledby="dropdownUser">
                        <li><a class="dropdown-item" href="#">Profile</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Sign out</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Pages Content -->
        <div id="page-content">
            <!-- Dashboard Page -->
            <div class="page" id="dashboard-page" style="display: block;">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stats-card mb-4">
                            <div class="stats-icon bg-primary-soft">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stats-info">
                                <h5>2,845</h5>
                                <span>Total Users</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card mb-4">
                            <div class="stats-icon bg-info-soft">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="stats-info">
                                <h5>14,721</h5>
                                <span>Total Products</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card mb-4">
                            <div class="stats-icon bg-success-soft">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stats-info">
                                <h5>$89,245</h5>
                                <span>Total Revenue</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card mb-4">
                            <div class="stats-icon bg-warning-soft">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stats-info">
                                <h5>1,354</h5>
                                <span>New Orders</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>Recent Orders</div>
                                <div>
                                    <a href="#" class="btn btn-sm btn-primary">View All</a>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Order ID</th>
                                                <th>Customer</th>
                                                <th>Product</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>#ORD-7841</td>
                                                <td>John Doe</td>
                                                <td>Dell XPS 13</td>
                                                <td>$1,299</td>
                                                <td><span class="badge bg-success badge-status">Completed</span></td>
                                                <td>10 May, 2025</td>
                                            </tr>
                                            <tr>
                                                <td>#ORD-7840</td>
                                                <td>Jane Smith</td>
                                                <td>Canon EOS R5</td>
                                                <td>$3,899</td>
                                                <td><span class="badge bg-warning badge-status">Processing</span></td>
                                                <td>09 May, 2025</td>
                                            </tr>
                                            <tr>
                                                <td>#ORD-7839</td>
                                                <td>Robert Johnson</td>
                                                <td>iPhone 15 Pro</td>
                                                <td>$1,099</td>
                                                <td><span class="badge bg-info badge-status">Shipped</span></td>
                                                <td>09 May, 2025</td>
                                            </tr>
                                            <tr>
                                                <td>#ORD-7838</td>
                                                <td>Emily Davis</td>
                                                <td>Logitech MX Master 3</td>
                                                <td>$99</td>
                                                <td><span class="badge bg-success badge-status">Completed</span></td>
                                                <td>08 May, 2025</td>
                                            </tr>
                                            <tr>
                                                <td>#ORD-7837</td>
                                                <td>Michael Wilson</td>
                                                <td>MacBook Pro 16"</td>
                                                <td>$2,499</td>
                                                <td><span class="badge bg-danger badge-status">Cancelled</span></td>
                                                <td>07 May, 2025</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                Top Selling Products
                            </div>
                            <div class="card-body p-0">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">Dell XPS 13</h6>
                                            <small class="text-muted">Laptops</small>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">284 sold</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">iPhone 15 Pro</h6>
                                            <small class="text-muted">Smartphones</small>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">251 sold</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">Canon EOS R5</h6>
                                            <small class="text-muted">Cameras</small>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">197 sold</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">Logitech MX Master 3</h6>
                                            <small class="text-muted">Accessories</small>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">184 sold</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">MacBook Pro 16"</h6>
                                            <small class="text-muted">Laptops</small>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">153 sold</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                Recent Activities
                            </div>
                            <div class="card-body p-0">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">New user registered</h6>
                                            <small class="text-muted">3 mins ago</small>
                                        </div>
                                        <small>Username: sam_wilson</small>
                                    </li>
                                    <li class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Stock update</h6>
                                            <small class="text-muted">20 mins ago</small>
                                        </div>
                                        <small>Lenovo ThinkPad X1 Carbon back in stock</small>
                                    </li>
                                    <li class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">New order placed</h6>
                                            <small class="text-muted">1 hour ago</small>
                                        </div>
                                        <small>Order #ORD-7841 by John Doe</small>
                                    </li>
                                    <li class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Product added</h6>
                                            <small class="text-muted">3 hours ago</small>
                                        </div>
                                        <small>New product: Samsung Galaxy S25</small>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Page -->
            <div class="page" id="users-page" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>User Management</div>
                        <div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                <i class="fas fa-plus"></i> Add New User
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <select class="form-select" id="filterRole">
                                    <option value="">All Roles</option>
                                    <option value="admin">Admin</option>
                                    <option value="customer">Customer</option>
                                    <option value="vendor">Vendor</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="filterStatus">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="userSearchInput" placeholder="Search users...">
                                    <button class="btn btn-outline-secondary" type="button" id="userSearchBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th class="avatar-col"></th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Registration Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="userTableBody">
                                    <!-- Dynamic user rows here -->
                                </tbody>
                            </table>
                        </div>
                        <nav>
                            <ul class="pagination justify-content-end" id="userPagination">
                                <!-- Pagination if needed -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Other pages would go here (products, categories, orders, etc.) -->
            <div class="page" id="products-page" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Products Management</span>
                        <div>
                            <a href="product-add.html?source=dashboard" class="btn btn-outline-primary me-2" target="_blank">
                                <i class="fa fa-external-link-alt"></i> Full Page View
                            </a>
                            <button type="button" class="btn btn-primary" id="addProductBtn" data-bs-toggle="modal" data-bs-target="#addProductModal">
                                <i class="fa fa-plus"></i> Add New Product
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Search Box -->
                        <div class="search-box mb-3">
                            <input type="text" id="searchProducts" class="form-control" placeholder="Search products by name, brand, or category...">
                        </div>
                        
                        <!-- Product List -->
                        <div id="productList">
                            <!-- Products will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page" id="categories-page" style="display: none;">
                <div class="card">
                    <div class="card-header">Categories Management</div>
                    <div class="card-body">
                        <p>Categories management content goes here.</p>
                    </div>
                </div>
            </div>
            
            <div class="page" id="orders-page" style="display: none;">
                <div class="card">
                    <div class="card-header">Orders Management</div>
                    <div class="card-body">
                        <p>Orders management content goes here.</p>
                    </div>
                </div>
            </div>
            
            <div class="page" id="reports-page" style="display: none;">
                <div class="card">
                    <div class="card-header">Reports</div>
                    <div class="card-body">
                        <p>Reports content goes here.</p>
                    </div>
                </div>
            </div>
            
            <div class="page" id="settings-page" style="display: none;">
                <div class="card">
                    <div class="card-header">Settings</div>
                    <div class="card-body">
                        <p>Settings content goes here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Modals -->
    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background-color: var(--primary-color); color: white;">
                    <h5 class="modal-title" id="addProductModalLabel">
                        <i class="fa fa-plus me-2"></i>Add New Product
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
                </div>
                <div class="modal-body" style="padding: 25px;">
                    <form id="addProductForm">
                        <div class="mb-3">
                            <label for="productName" class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="productName" placeholder="Enter product name">
                        </div>

                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="productDescription" placeholder="Enter product description"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="productWarranty" class="form-label">Warranty (months)</label>
                            <input type="number" class="form-control" id="productWarranty" placeholder="Enter warranty in months">
                        </div>

                        <div class="mb-3">
                            <label for="productCategory" class="form-label">Category</label>
                            <select class="form-select" id="productCategory">
                                <option value="">Select category</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="productBrand" class="form-label">Brand</label>
                            <select class="form-select" id="productBrand">
                                <option value="">Select brand</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="productVendor" class="form-label">Vendor</label>
                            <select class="form-select" id="productVendor">
                                <option value="">Select vendor</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="productType" class="form-label">Product Type</label>
                            <select class="form-select" id="productType">
                                <option value="">Select type</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="productPurchasePrice" class="form-label">Purchase Price ($)</label>
                            <input type="number" step="0.01" class="form-control" id="productPurchasePrice">
                        </div>

                        <div class="mb-3">
                            <label for="productSalesPrice" class="form-label">Sales Price ($)</label>
                            <input type="number" step="0.01" class="form-control" id="productSalesPrice">
                        </div>

                        <div class="mb-3">
                            <label for="productDiscountPrice" class="form-label">Discount Price ($)</label>
                            <input type="number" step="0.01" class="form-control" id="productDiscountPrice">
                        </div>

                        <div class="mb-3">
                            <label for="productFinalPrice" class="form-label">Final Price ($)</label>
                            <input type="number" step="0.01" class="form-control" id="productFinalPrice" readonly>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #e0e0e0; padding: 15px 25px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="addProductForm" class="btn btn-primary" style="background-color: var(--primary-color); border: none;">
                        <i class="fa fa-save me-1"></i>Add Product
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="userName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="userName" placeholder="Enter user name" required>
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="userEmail" placeholder="Enter user email" required>
                        </div>
                        <div class="mb-3">
                            <label for="userRole" class="form-label">Role</label>
                            <select class="form-select" id="userRole" required>
                                <option value="">Select role</option>
                                <option value="admin">Admin</option>
                                <option value="customer">Customer</option>
                                <option value="vendor">Vendor</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="userStatus" class="form-label">Status</label>
                            <select class="form-select" id="userStatus" required>
                                <option value="">Select status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="addUserForm" class="btn btn-primary">Add User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View User Modal -->
    <div class="modal fade" id="viewUserModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">View User</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="viewUserModalBody">
            <!-- User details here -->
          </div>
        </div>
      </div>
    </div>
    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit User</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="editUserForm">
            <div class="modal-body" id="editUserModalBody">
              <!-- Edit form here -->
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Delete User Modal -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delete User</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="deleteUserModalBody">
            <!-- Delete confirmation here -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" id="confirmDeleteUserBtn">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/dataSource.js"></script>
    
    <script>
        $(document).ready(function() {
            // Assume getCurrentUser() is defined in dataSource.js
            const user = getCurrentUser();
            if (!user || user.role !== 'admin') {
                // Show permission message
                $('body').html('<div class="container mt-5"><div class="alert alert-danger text-center" role="alert">You do not have permission to access this page.</div></div>');
                // Redirect to index.html after short delay
                setTimeout(function() {
                    window.location.href = 'index.html';
                }, 2000);
            }
        });


        let allProducts = [];

        // Function to render product list
        function renderProductList(products = allProducts) {
            const productListContainer = $('#productList');
            productListContainer.empty();
            
            if (products.length === 0) {
                productListContainer.html('<p class="text-muted">No products found.</p>');
                return;
            }

            products.forEach(product => {
                const productCard = `
                    <div class="product-card">
                        <div class="product-name">${product.productname}</div>
                        <div class="product-details">
                            <div class="product-detail">
                                <strong>Brand:</strong> ${product.brandname}
                            </div>
                            <div class="product-detail">
                                <strong>Category:</strong> ${product.categoryname}
                            </div>
                            <div class="product-detail">
                                <strong>Type:</strong> ${product.producttypename}
                            </div>
                            <div class="product-detail">
                                <strong>Vendor:</strong> ${product.vendorname}
                            </div>
                            <div class="product-detail">
                                <strong>Warranty:</strong> ${product.warrantymonths} months
                            </div>
                            <div class="product-detail">
                                <strong>Rating:</strong> <span class="rating">${product.rating} ‚≠ê</span>
                            </div>
                        </div>
                        <div class="product-detail">
                            <strong>Description:</strong> ${product.description}
                        </div>
                        <div class="price-section">
                            <span class="price final-price">$${product.finalprice.toFixed(2)}</span>
                            <span class="price sales-price">$${product.salesprice.toFixed(2)}</span>
                            <span class="price discount-price">-$${product.discountprice.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                productListContainer.append(productCard);
            });
        }

        // Search functionality
        function setupSearch() {
            $('#searchProducts').on('input', function() {
                const searchTerm = $(this).val().toLowerCase();
                const filteredProducts = allProducts.filter(product => {
                    return product.productname.toLowerCase().includes(searchTerm) ||
                           product.brandname.toLowerCase().includes(searchTerm) ||
                           product.categoryname.toLowerCase().includes(searchTerm) ||
                           product.description.toLowerCase().includes(searchTerm);
                });
                renderProductList(filteredProducts);
            });
        }

        // Reset form when modal is closed
        function setupModalEvents() {
            $('#addProductModal').on('hidden.bs.modal', function () {
                $('#addProductForm')[0].reset();
                updateFinalPrice();
            });
        }

        // Populate form fields with data from dataSource
        function populateFormFields() {
            // Populate categories
            const categorySelect = $('#productCategory');
            categorySelect.empty().append('<option value="">Select category</option>');
            if (typeof dataSource !== 'undefined' && dataSource.categories) {
                dataSource.categories.forEach(category => {
                    categorySelect.append(`<option value="${category.category_id}">${category.categoryname}</option>`);
                });
            }

            // Populate brands
            const brandSelect = $('#productBrand');
            brandSelect.empty().append('<option value="">Select brand</option>');
            if (typeof dataSource !== 'undefined' && dataSource.brands) {
                dataSource.brands.forEach(brand => {
                    brandSelect.append(`<option value="${brand.brand_id}">${brand.brandname}</option>`);
                });
            }

            // Populate vendors
            const vendorSelect = $('#productVendor');
            vendorSelect.empty().append('<option value="">Select vendor</option>');
            if (typeof dataSource !== 'undefined' && dataSource.vendors) {
                dataSource.vendors.forEach(vendor => {
                    vendorSelect.append(`<option value="${vendor.vendor_id}">${vendor.vendorname}</option>`);
                });
            }

            // Populate product types
            const productTypeSelect = $('#productType');
            productTypeSelect.empty().append('<option value="">Select type</option>');
            if (typeof dataSource !== 'undefined' && dataSource.productTypes) {
                dataSource.productTypes.forEach(productType => {
                    productTypeSelect.append(`<option value="${productType.product_type_id}">${productType.producttypename}</option>`);
                });
            }
        }

        // Auto update final price when user types in sales or discount price
        function updateFinalPrice() {
            const salesPrice = parseFloat($('#productSalesPrice').val()) || 0;
            const discountPrice = parseFloat($('#productDiscountPrice').val()) || 0;
            const finalPrice = Math.max(salesPrice - discountPrice, 0);
            $('#productFinalPrice').val(finalPrice.toFixed(2));
        }

        // Initialize product management when products page is shown
        function initializeProductManagement() {
            // Store products data for searching
            allProducts = (typeof dataSource !== 'undefined' && dataSource.products) ? dataSource.products : [];
            
            // Render initial product list
            renderProductList();
            
            // Setup search functionality
            setupSearch();
            
            // Setup modal events
            setupModalEvents();
            
            // Populate form fields
            populateFormFields();
            
            // Setup price calculation
            $('#productSalesPrice, #productDiscountPrice').on('input', updateFinalPrice);
        }

        // Check URL hash to show products page if linked from product-add
        function checkUrlHash() {
            const hash = window.location.hash;
            if (hash === '#products') {
                showProductsPage();
            }
        }

        // Function to show products page
        function showProductsPage() {
            // Remove active class from all nav links
            $('.nav-link').removeClass('active');
            
            // Add active class to products nav link
            $('.nav-link[data-page="products"]').addClass('active');
            
            // Hide all pages
            $('.page').hide();
            
            // Show products page
            $('#products-page').show();
            
            // Initialize product management
            setTimeout(initializeProductManagement, 100);
        }

        // Navigation functionality
        $(document).ready(function() {
            // Check URL hash on page load
            checkUrlHash();
            
            // Initialize navigation
            $('.nav-link').click(function(e) {
                e.preventDefault();
                
                // Remove active class from all nav links
                $('.nav-link').removeClass('active');
                
                // Add active class to clicked nav link
                $(this).addClass('active');
                
                // Hide all pages
                $('.page').hide();
                
                // Get target page
                const targetPage = $(this).data('page');
                
                if (targetPage) {
                    // Show target page
                    $('#' + targetPage + '-page').show();
                    
                    // Update URL hash
                    window.location.hash = targetPage;
                    
                    // If products page is shown, initialize product management
                    if (targetPage === 'products') {
                        setTimeout(initializeProductManagement, 100);
                    }
                } else {
                    // Show dashboard by default
                    $('#dashboard-page').show();
                    window.location.hash = '';
                }
            });

            // Handle form submission
            $(document).on('submit', '#addProductForm', function (e) {
                e.preventDefault();

                const data = {
                    name: $('#productName').val().trim(),
                    description: $('#productDescription').val().trim() || "",
                    warrantyMonths: parseInt($('#productWarranty').val(), 10) || 0,
                    productTypeId: $('#productType').val(),
                    categoryId: $('#productCategory').val(),
                    brandId: $('#productBrand').val(),
                    vendorId: $('#productVendor').val(),
                    purchasePrice: parseFloat($('#productPurchasePrice').val()) || 0,
                    salesPrice: parseFloat($('#productSalesPrice').val()) || 0,
                    discountPrice: parseFloat($('#productDiscountPrice').val()) || 0,
                    finalPrice: parseFloat($('#productFinalPrice').val()) || 0,
                    priceEffectiveFrom: new Date().toISOString(),
                    priceEffectiveTo: new Date().toISOString()
                };

                if (!data.name || !data.categoryId || !data.brandId || !data.vendorId || !data.productTypeId) {
                    alert('Please fill out all required fields.');
                    return;
                }

                $.ajax({
                    url: 'https://localhost:7111/api/product',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (response) {
                        alert('Product added successfully!');
                        $('#addProductForm')[0].reset();
                        updateFinalPrice();
                        
                        // If the API returns the new product, add it to the list
                        if (response && response.productid) {
                            allProducts.push(response);
                            renderProductList();
                        }
                        
                        // Close the modal
                        $('#addProductModal').modal('hide');
                    },
                    error: function (xhr, status, error) {
                        console.error('Error:', error);
                        alert('Failed to add product. Error: ' + error);
                    }
                });
            });

            // User Management Logic
            let allUsers = [];
            let filteredUsers = [];
            let currentEditUserId = null;
            let currentDeleteUserId = null;

            function normalizeUser(u) {
              return {
                id: u.id,
                name: u.userName || u.name || '',
                email: u.email,
                role: (u.role === 'admin' || u.role === 'customer' || u.role === 'vendor') ? u.role : (u.role === 'user' ? 'customer' : u.role),
                status: u.status || 'active',
                registrationDate: (u.createdAt ? new Date(u.createdAt).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) : (u.registrationDate || ''))
              };
            }

            function renderUserTable(users) {
              const tbody = $('#userTableBody');
              tbody.empty();
              if (!users.length) {
                tbody.append('<tr><td colspan="7" class="text-center text-muted">No users found.</td></tr>');
                return;
              }
              users.forEach(user => {
                const statusClass = user.status === 'active' ? 'bg-success' : (user.status === 'inactive' ? 'bg-warning' : 'bg-danger');
                tbody.append(`
                  <tr>
                    <td><img src="img/default.png" alt="User" class="user-avatar"></td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</td>
                    <td><span class="badge ${statusClass} badge-status">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span></td>
                    <td>${user.registrationDate || ''}</td>
                    <td class="user-action">
                      <a href="#" class="text-info me-2 view-user-btn" data-user-id="${user.id}" data-bs-toggle="modal" data-bs-target="#viewUserModal"><i class="fas fa-eye"></i></a>
                      <a href="#" class="text-primary me-2 edit-user-btn" data-user-id="${user.id}" data-bs-toggle="modal" data-bs-target="#editUserModal"><i class="fas fa-edit"></i></a>
                      <a href="#" class="text-danger delete-user-btn" data-user-id="${user.id}" data-bs-toggle="modal" data-bs-target="#deleteUserModal"><i class="fas fa-trash"></i></a>
                    </td>
                  </tr>
                `);
              });
            }

            function filterAndRenderUsers() {
              const role = $('#filterRole').val();
              const status = $('#filterStatus').val();
              const search = $('#userSearchInput').val().toLowerCase();
              filteredUsers = allUsers.filter(user => {
                const matchesRole = !role || user.role === role;
                const matchesStatus = !status || user.status === status;
                const matchesSearch = !search || user.name.toLowerCase().includes(search) || user.email.toLowerCase().includes(search);
                return matchesRole && matchesStatus && matchesSearch;
              });
              renderUserTable(filteredUsers);
            }

            function showViewUserModal(userId) {
              const user = allUsers.find(u => u.id === userId);
              if (!user) return;
              $('#viewUserModalBody').html(`
                <div class="user-detail">
                  <img src="https://via.placeholder.com/150" class="user-avatar me-3" alt="User">
                  <div>
                    <h5>${user.name}</h5>
                    <p class="mb-1"><strong>Email:</strong> ${user.email}</p>
                    <p class="mb-1"><strong>Role:</strong> ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</p>
                    <p class="mb-1"><strong>Status:</strong> ${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</p>
                    <p class="mb-1"><strong>Registration Date:</strong> ${user.registrationDate || ''}</p>
                  </div>
                </div>
              `);
            }

            function showEditUserModal(userId) {
              const user = allUsers.find(u => u.id === userId);
              if (!user) return;
              currentEditUserId = userId;
              $('#editUserModalBody').html(`
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" name="name" value="${user.name}" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" name="email" value="${user.email}" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Role</label>
                  <select class="form-select" name="role" required>
                    <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                    <option value="customer" ${user.role === 'customer' ? 'selected' : ''}>Customer</option>
                    <option value="vendor" ${user.role === 'vendor' ? 'selected' : ''}>Vendor</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Status</label>
                  <select class="form-select" name="status" required>
                    <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
                    <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                    <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>Suspended</option>
                  </select>
                </div>
              `);
            }

            function showDeleteUserModal(userId) {
              const user = allUsers.find(u => u.id === userId);
              if (!user) return;
              currentDeleteUserId = userId;
              $('#deleteUserModalBody').html(`<p>Are you sure you want to delete <strong>${user.name}</strong>?</p>`);
            }

            function setupUserManagement() {
              // Use global users array if available, else fallback to dataSource.users
              let rawUsers = (typeof users !== 'undefined' && Array.isArray(users) && users.length) ? users : (typeof dataSource !== 'undefined' && Array.isArray(dataSource.users) ? dataSource.users : []);
              allUsers = rawUsers.map(normalizeUser);
              filteredUsers = allUsers;
              renderUserTable(allUsers);

              // Filter/search events
              $('#filterRole, #filterStatus').off('change').on('change', filterAndRenderUsers);
              $('#userSearchInput').off('input').on('input', filterAndRenderUsers);
              $('#userSearchBtn').off('click').on('click', filterAndRenderUsers);

              // View user
              $(document).off('click', '.view-user-btn').on('click', '.view-user-btn', function() {
                const userId = $(this).data('user-id');
                showViewUserModal(userId);
              });
              // Edit user
              $(document).off('click', '.edit-user-btn').on('click', '.edit-user-btn', function() {
                const userId = $(this).data('user-id');
                showEditUserModal(userId);
              });
              // Delete user
              $(document).off('click', '.delete-user-btn').on('click', '.delete-user-btn', function() {
                const userId = $(this).data('user-id');
                showDeleteUserModal(userId);
              });
              // Save edit
              $('#editUserForm').off('submit').on('submit', function(e) {
                e.preventDefault();
                const form = $(this);
                const user = allUsers.find(u => u.id === currentEditUserId);
                if (user) {
                  user.name = form.find('[name="name"]').val();
                  user.email = form.find('[name="email"]').val();
                  user.role = form.find('[name="role"]').val();
                  user.status = form.find('[name="status"]').val();
                  filterAndRenderUsers();
                  $('#editUserModal').modal('hide');
                }
              });
              // Confirm delete
              $('#confirmDeleteUserBtn').off('click').on('click', function() {
                allUsers = allUsers.filter(u => u.id !== currentDeleteUserId);
                filterAndRenderUsers();
                $('#deleteUserModal').modal('hide');
              });
            }

            // Navigation: initialize user management when users page is shown
            $('.nav-link').click(function(e) {
                e.preventDefault();
                
                // Remove active class from all nav links
                $('.nav-link').removeClass('active');
                
                // Add active class to clicked nav link
                $(this).addClass('active');
                
                // Hide all pages
                $('.page').hide();
                
                // Get target page
                const targetPage = $(this).data('page');
                
                if (targetPage) {
                    // Show target page
                    $('#' + targetPage + '-page').show();
                    
                    // Update URL hash
                    window.location.hash = targetPage;
                    
                    // If products page is shown, initialize product management
                    if (targetPage === 'products') {
                        setTimeout(initializeProductManagement, 100);
                    }
                    // If users page is shown, setup user management
                    else if (targetPage === 'users') {
                        setTimeout(setupUserManagement, 100);
                    }
                } else {
                    // Show dashboard by default
                    $('#dashboard-page').show();
                    window.location.hash = '';
                }
            });
        });
    </script>
</body>
</html>