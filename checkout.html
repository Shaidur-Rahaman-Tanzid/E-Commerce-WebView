<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

		<title>PC-Shop - Checkout</title>

 		<!-- Google font -->
 		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

 		<!-- Bootstrap -->
 		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>

 		<!-- Slick -->
 		<link type="text/css" rel="stylesheet" href="css/slick.css"/>
 		<link type="text/css" rel="stylesheet" href="css/slick-theme.css"/>

 		<!-- nouislider -->
 		<link type="text/css" rel="stylesheet" href="css/nouislider.min.css"/>

 		<!-- Font Awesome Icon -->
 		<link rel="stylesheet" href="css/font-awesome.min.css">

 		<!-- Custom stlylesheet -->
 		<link type="text/css" rel="stylesheet" href="css/style.css"/>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/dataSource.js"></script>
		<script src="js/main.js"></script>
		<script src="js/function.js"></script>
		
		<script>
			// Scripts loaded successfully
		</script>

		<style>
			/* Checkout specific styles */
			.cart-item {
				display: flex;
				align-items: center;
				padding: 15px 0;
				border-bottom: 1px solid #eee;
			}
			
			.cart-item:last-child {
				border-bottom: none;
			}
			
			.cart-item-img {
				width: 80px;
				height: 80px;
				margin-right: 15px;
				border-radius: 8px;
				overflow: hidden;
			}
			
			.cart-item-img img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}
			
			.cart-item-details {
				flex: 1;
			}
			
			.cart-item-name {
				font-weight: 600;
				margin-bottom: 5px;
				color: #333;
			}
			
			.cart-item-price {
				color: #D10024;
				font-weight: 600;
			}
			
			.quantity-controls {
				display: flex;
				align-items: center;
				gap: 10px;
				margin-top: 10px;
			}
			
			.quantity-btn {
				width: 30px;
				height: 30px;
				border: 1px solid #ddd;
				background: #fff;
				border-radius: 4px;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: bold;
			}
			
			.quantity-btn:hover {
				background: #f5f5f5;
			}
			
			.quantity-input {
				width: 50px;
				height: 30px;
				text-align: center;
				border: 1px solid #ddd;
				border-radius: 4px;
			}
			
			.remove-item {
				background: none;
				border: none;
				color: #D10024;
				cursor: pointer;
				font-size: 16px;
				margin-left: 10px;
			}
			
			.remove-item:hover {
				color: #b3001f;
			}
			
			.order-summary {
				background: #f8f9fa;
				padding: 20px;
				border-radius: 8px;
				margin-bottom: 20px;
			}
			
			.order-row {
				display: flex;
				justify-content: space-between;
				padding: 8px 0;
				border-bottom: 1px solid #eee;
			}
			
			.order-row:last-child {
				border-bottom: none;
				font-weight: bold;
				font-size: 18px;
				color: #D10024;
			}
			
			.empty-cart {
				text-align: center;
				padding: 40px 20px;
				color: #666;
			}
			
			.empty-cart i {
				font-size: 4rem;
				color: #ddd;
				margin-bottom: 20px;
			}
			
			.payment-method {
				margin: 20px 0;
			}
			
			.payment-option {
				display: flex;
				align-items: center;
				padding: 15px;
				border: 2px solid #eee;
				border-radius: 8px;
				margin-bottom: 10px;
				cursor: pointer;
				transition: all 0.3s ease;
			}
			
			.payment-option:hover {
				border-color: #D10024;
			}
			
			.payment-option.selected {
				border-color: #D10024;
				background: #fff5f5;
			}
			
			.payment-option input[type="radio"] {
				margin-right: 10px;
			}
			
			.payment-option label {
				margin: 0;
				cursor: pointer;
				font-weight: 600;
			}
			
			.payment-number {
				margin-top: 10px;
				padding: 10px;
				background: #f8f9fa;
				border-radius: 4px;
				font-size: 14px;
				color: #666;
			}

			/* Custom Alert Box */
			.custom-alert {
				position: fixed;
				top: 20px;
				right: 20px;
				background: #fff;
				border-radius: 8px;
				box-shadow: 0 4px 20px rgba(0,0,0,0.15);
				padding: 15px 20px;
				z-index: 9999;
				transform: translateX(400px);
				transition: transform 0.3s ease;
				max-width: 300px;
				border-left: 4px solid #D10024;
			}
			
			.custom-alert.show {
				transform: translateX(0);
			}
			
			.custom-alert.success {
				border-left-color: #28a745;
			}
			
			.custom-alert.error {
				border-left-color: #dc3545;
			}
			
			.custom-alert.info {
				border-left-color: #17a2b8;
			}
			
			.custom-alert .alert-content {
				display: flex;
				align-items: center;
				gap: 10px;
			}
			
			.custom-alert .alert-icon {
				font-size: 18px;
				color: #D10024;
			}
			
			.custom-alert.success .alert-icon {
				color: #28a745;
			}
			
			.custom-alert.error .alert-icon {
				color: #dc3545;
			}
			
			.custom-alert.info .alert-icon {
				color: #17a2b8;
			}
			
			.custom-alert .alert-message {
				font-size: 14px;
				color: #333;
				font-weight: 500;
			}
		</style>
	</head>
	<body>
		<!-- HEADER -->
		<header>
			<!-- TOP HEADER -->
			<div id="top-header">
				<div class="container">
					<ul class="header-links pull-left">
						<li><a href="#"><i class="fa fa-phone"></i> +8801706782347</a></li>
						<li><a href="#"><i class="fa fa-envelope-o"></i> sahidtanzid2014@gmail.com</a></li>
						<li><a href="#"><i class="fa fa-map-marker"></i> Rajshshi, Bangladesh</a></li>
					</ul>
					<ul class="header-links pull-right">
						<li><a href="profile.html"><i class="fa fa-user-o"></i> Profile</a></li>
						<li><a href="login.html" id="checkout-auth-link"><i class="fa fa-user-o auth-link"></i> LogIn</a></li>
					</ul>
				</div>
			</div>
			<!-- /TOP HEADER -->

			<!-- MAIN HEADER -->
			<div id="header">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<!-- LOGO -->
						<div class="col-md-3">
							<div class="header-logo">
								<a href="index.html" class="logo">
									<span style="
										font-size: xxx-large;
										color: #D10024;
									">PC-Shop</span>
								</a>
							</div>
						</div>
						<!-- /LOGO -->

						<!-- SEARCH BAR -->
						<div class="col-md-6">
							<div class="header-search">
								<form id="headerSearchForm" onsubmit="performSearch(event)">
									<select class="input-select" name="search-category" id="search-category" title="Select category">
										<option value="">All Categories</option>
									</select>
									<input class="input" id="header-search-input" placeholder="Search here" name="search-term">
									<button type="submit" class="search-btn">Search</button>
								</form>
							</div>
						</div>
						<!-- /SEARCH BAR -->

						<!-- ACCOUNT -->
						<div class="col-md-3 clearfix">
							<div class="header-ctn">
								<!-- Wishlist -->
								<div>
									<a href="wishlist-page.html">
										<i class="fa fa-heart-o"></i>
										<span>Your Wishlist</span>
										<div class="qty" id="wishlist-count">0</div>
									</a>
								</div>
								<!-- /Wishlist -->

								<!-- Cart -->
								<div class="dropdown">
									<a class="dropdown-toggle" data-toggle="dropdown" onclick="handleCartClick(event)">
										<i class="fa fa-shopping-cart"></i>
										<span>Your Cart</span>
										<div class="qty" id="cart-count">0</div>
									</a>
									<div class="cart-dropdown">
										<div class="cart-list" id="cart-dropdown-list">
											<!-- Cart items will be loaded here -->
										</div>
										<div class="cart-summary">
											<small id="cart-summary-text">0 Item(s) selected</small>
											<h5 id="cart-subtotal">SUBTOTAL: ৳0.00</h5>
										</div>
										<div class="cart-btns">
											<a href="checkout.html">View Cart</a>
											<a href="checkout.html">Checkout <i class="fa fa-arrow-circle-right"></i></a>
										</div>
									</div>
								</div>
								<!-- /Cart -->

								<!-- Menu Toogle -->
								<div class="menu-toggle">
									<a href="#">
										<i class="fa fa-bars"></i>
										<span>Menu</span>
									</a>
								</div>
								<!-- /Menu Toogle -->
							</div>
						</div>
						<!-- /ACCOUNT -->
					</div>
					<!-- row -->
				</div>
				<!-- container -->
			</div>
			<!-- /MAIN HEADER -->
		</header>
		<!-- /HEADER -->

		<!-- Custom Alert Box -->
		<div id="customAlert" class="custom-alert" style="display: none;">
			<div class="alert-content">
				<i class="alert-icon fa fa-info-circle"></i>
				<span class="alert-message">Message here</span>
			</div>
		</div>

		<!-- BREADCRUMB -->
		<div id="breadcrumb" class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-md-12">
						<h3 class="breadcrumb-header">Checkout</h3>
						<ul class="breadcrumb-tree">
							<li><a href="index.html">Home</a></li>
							<li><a href="store.html">Store</a></li>
							<li class="active">Checkout</li>
						</ul>
					</div>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /BREADCRUMB -->

		<!-- SECTION -->
		<div class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">

					<div class="col-md-7">
						<!-- Billing Details -->
						<div class="billing-details">
							<div class="section-title">
								<h3 class="title">Shipping & Billing Address</h3>
							</div>
							<div class="form-group">
								<input class="input" type="text" id="user-name" name="name" placeholder="Name" required>
							</div>
							<div class="form-group">
								<input class="input" type="email" id="user-email" name="email" placeholder="Email" required>
							</div>
							<div class="form-group">
								<input class="input" type="tel" id="user-phone" name="phone" placeholder="Phone Number" required>
							</div>
							<div class="form-group">
								<input class="input" type="text" id="user-address" name="address" placeholder="Address" required>
							</div>
							<div class="form-group">
								<textarea class="input" id="user-notes" name="notes" placeholder="Order Notes (Optional)" rows="3"></textarea>
							</div>
						</div>
						<!-- /Billing Details -->
					</div>

					<!-- Order Details -->
					<div class="col-md-5 order-details">
						<div class="section-title text-center">
							<h3 class="title">Your Order</h3>
						</div>
						
						<!-- Cart Items -->
						<div id="checkout-cart-items">
							<!-- Cart items will be loaded here -->
						</div>
						
						<!-- Order Summary -->
						<div class="order-summary">
							<div class="order-row">
								<div>Subtotal</div>
								<div id="order-subtotal">৳0.00</div>
							</div>
							<div class="order-row">
								<div>Shipping</div>
								<div><strong>FREE</strong></div>
							</div>
							<div class="order-row">
								<div><strong>TOTAL</strong></div>
								<div><strong id="order-total">৳0.00</strong></div>
							</div>
						</div>
						
						<!-- Payment Method -->
						<div class="payment-method">
							<h4>Payment Method</h4>
							<div class="payment-option" onclick="selectPayment('bkash')">
								<input type="radio" name="payment" id="payment-bkash" value="bkash">
								<label for="payment-bkash">BKash Payment</label>
								<!-- <div class="payment-number">Number: 01706782347</div> -->
							</div>
							<div class="payment-option" onclick="selectPayment('nagad')">
								<input type="radio" name="payment" id="payment-nagad" value="nagad">
								<label for="payment-nagad">Nagad Payment</label>
								<!-- <div class="payment-number">Number: 01706782347</div> -->
							</div>
						</div>
						
						<div class="input-checkbox">
							<input type="checkbox" id="terms" required>
							<label for="terms">
								<span></span>
								I've read and accept the <a href="#">terms & conditions</a>
							</label>
						</div>
						<button id="place-order-btn" class="primary-btn order-submit" onclick="placeOrder()">Place order</button>
					</div>
					<!-- /Order Details -->
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /SECTION -->



		<!-- FOOTER -->
		<footer id="footer">
			<!-- top footer -->
			<div class="section">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">About Us</h3>
								<p>We provide high-quality PC components for gamers, builders, and tech enthusiasts. From GPUs to cooling systems, we're your trusted source for performance and reliability.</p>
								<ul class="footer-links">
									<li><a href="#"><i class="fa fa-map-marker"></i>Rajshshi, Bangladesh</a></li>
									<li><a href="#"><i class="fa fa-phone"></i>+8801706782347</a></li>
									<li><a href="#"><i class="fa fa-envelope-o"></i>sahidtanzid2014@gmail.com</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Categories</h3>
								<ul class="footer-links">
									<li><a href="#">Hot deals</a></li>
									<li><a href="#">Laptops</a></li>
									<li><a href="#">Smartphones</a></li>
									<li><a href="#">Cameras</a></li>
									<li><a href="#">Accessories</a></li>
								</ul>
							</div>
						</div>

						<div class="clearfix visible-xs"></div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Information</h3>
								<ul class="footer-links">
									<li><a href="#">About Us</a></li>
									<li><a href="#">Contact Us</a></li>
									<li><a href="#">Privacy Policy</a></li>
									<li><a href="#">Orders and Returns</a></li>
									<li><a href="#">Terms & Conditions</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Service</h3>
								<ul class="footer-links">
									<li><a href="#">My Account</a></li>
									<li><a href="#">View Cart</a></li>
									<li><a href="wishlist-page.html">Wishlist</a></li>
									<li><a href="#">Track My Order</a></li>
									<li><a href="#">Help</a></li>
								</ul>
							</div>
						</div>
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /top footer -->

			<!-- bottom footer -->
			<div id="bottom-footer" class="section">
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-12 text-center">
							<ul class="footer-payments">
								<li><a href="#"><i class="fa fa-cc-visa"></i></a></li>
								<li><a href="#"><i class="fa fa-credit-card"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-paypal"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-mastercard"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-discover"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-amex"></i></a></li>
							</ul>
							<span class="copyright">
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
								Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							</span>
						</div>
					</div>
						<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /bottom footer -->
		</footer>
		<!-- /FOOTER -->

		<!-- jQuery Plugins -->
		<script src="js/bootstrap.min.js"></script>
		<script src="js/slick.min.js"></script>
		<script src="js/nouislider.min.js"></script>
		<script src="js/jquery.zoom.min.js"></script>

		<script>
			// Custom Alert Function
			function showCustomAlert(message, type = 'info') {
				const alertBox = document.getElementById('customAlert');
				const alertIcon = alertBox.querySelector('.alert-icon');
				const alertMessage = alertBox.querySelector('.alert-message');
				
				// Set message
				alertMessage.textContent = message;
				
				// Set type and icon
				alertBox.className = `custom-alert ${type}`;
				
				switch(type) {
					case 'success':
						alertIcon.className = 'alert-icon fa fa-check-circle';
						break;
					case 'error':
						alertIcon.className = 'alert-icon fa fa-times-circle';
						break;
					case 'info':
					default:
						alertIcon.className = 'alert-icon fa fa-info-circle';
						break;
				}
				
				// Show alert
				alertBox.style.display = 'block';
				setTimeout(() => {
					alertBox.classList.add('show');
				}, 100);
				
				// Auto hide after 2 seconds
				setTimeout(() => {
					alertBox.classList.remove('show');
					setTimeout(() => {
						alertBox.style.display = 'none';
					}, 300);
				}, 2000);
			}

			// Global variables
			let cartItems = [];
			let selectedPayment = '';

			// ========================================
			// CART FUNCTIONALITY
			// ========================================

			// Get wishlist from current user
			function getWishlist() {
				const user = getCurrentUser();
				return user && Array.isArray(user.wishlist) ? user.wishlist : [];
			}
			function updateWishlistCount() {
				const wishlist = getWishlist();
				const countElement = document.getElementById('wishlist-count');
				if (countElement) {
					countElement.textContent = wishlist.length;
				}
			}
			// CART FUNCTIONALITY
			function getCart() {
				const user = getCurrentUser();
				
				if (!user) {
					return [];
				}
				
				if (!Array.isArray(user.cartItems)) {
					return [];
				}
				
				return user.cartItems;
			}
			function saveCart(cart) {
				const user = getCurrentUser();
				if (user) {
					user.cartItems = cart;
					setCurrentUser(user);
				}
				updateCartCount();
			}
			function updateCartCount() {
				const cart = getCart();
				const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
				const countElement = document.getElementById('cart-count');
				if (countElement) {
					countElement.textContent = totalItems;
				}
			}
			function handleCartClick(event) {
				const userId = getCurrentUserId();
				if (!userId) {
					// If not logged in, do nothing
					return;
				}
				const cart = getCart();
				const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
				if (totalItems > 0) {
					// Prevent dropdown from opening
					event.preventDefault();
					event.stopPropagation();
					// Refresh the page to update cart display (since we're already on checkout)
					window.location.reload();
				}
				// If cart is empty, do nothing
			}
			function removeFromCart(productId) {
				const cart = getCart();
				const updatedCart = cart.filter(item => item.productId !== productId);
				saveCart(updatedCart);
				loadCheckoutCart();
			}
			function loadCheckoutCart() {
				const cart = getCart();
				const container = document.getElementById('checkout-cart-items');
				
				if (!container) {
					return;
				}
				
				if (cart.length === 0) {
					container.innerHTML = `
						<div class="empty-cart">
							<i class="fa fa-shopping-cart"></i>
							<h3>Your cart is empty</h3>
							<p>Add some products to your cart to continue with checkout</p>
							<a href="store.html" class="primary-btn">Continue Shopping</a>
						</div>
					`;
					const placeOrderBtn = document.getElementById('place-order-btn');
					if (placeOrderBtn) {
						placeOrderBtn.style.display = 'none';
					}
					return;
				}

				const placeOrderBtn = document.getElementById('place-order-btn');
				if (placeOrderBtn) {
					placeOrderBtn.style.display = 'block';
				}
				
				let html = '';
				let subtotal = 0;

				cart.forEach((item, index) => {
					const product = dataSource.products.find(p => p.productid === item.productId);
					
					if (product) {
						const itemTotal = product.finalprice * item.quantity;
						subtotal += itemTotal;
						const img = getProductImage(product.producttypename, product.productname);

						html += `
							<div class="cart-item">
								<div class="cart-item-img">
									<img src="./img/${img}" alt="${product.productname}">
								</div>
								<div class="cart-item-details">
									<div class="cart-item-name">${product.productname}</div>
									<div class="cart-item-price">৳${product.finalprice.toFixed(2)}</div>
									<div class="quantity-controls">
										<button class="quantity-btn" onclick="updateQuantity('${product.productid}', ${item.quantity - 1})" title="Decrease quantity">-</button>
										<input type="number" class="quantity-input" value="${item.quantity}" min="1" onchange="updateQuantity('${product.productid}', parseInt(this.value))">
										<button class="quantity-btn" onclick="updateQuantity('${product.productid}', ${item.quantity + 1})" title="Increase quantity">+</button>
										<button class="remove-item" onclick="removeFromCart('${product.productid}')" title="Remove item">
											<i class="fa fa-trash"></i>
										</button>
									</div>
								</div>
								<div class="cart-item-total">
									<strong>৳${itemTotal.toFixed(2)}</strong>
								</div>
							</div>
						`;
					}
				});

				container.innerHTML = html;
				
				// Update totals
				const subtotalElement = document.getElementById('order-subtotal');
				const totalElement = document.getElementById('order-total');
				if (subtotalElement) {
					subtotalElement.textContent = `৳${subtotal.toFixed(2)}`;
				}
				if (totalElement) {
					totalElement.textContent = `৳${subtotal.toFixed(2)}`;
				}
			}

			// Select payment method
			function selectPayment(method) {
				selectedPayment = method;
				
				// Update UI
				document.querySelectorAll('.payment-option').forEach(option => {
					option.classList.remove('selected');
				});
				
				event.currentTarget.classList.add('selected');
				document.getElementById(`payment-${method}`).checked = true;
			}

			// Place order
			function placeOrder() {
				const cart = getCart();
				
				if (cart.length === 0) {
					showCustomAlert('Your cart is empty!', 'error');
					return;
				}

				if (!selectedPayment) {
					showCustomAlert('Please select a payment method!', 'error');
					return;
				}

				// Validate form
				const requiredFields = ['first-name', 'last-name', 'email', 'phone', 'address', 'city', 'zip-code'];
				for (let field of requiredFields) {
					const input = document.querySelector(`input[name="${field}"]`);
					if (!input.value.trim()) {
							showCustomAlert(`${field} is required!`, 'error');
						return;
					}
				}

				// Create order object
				const order = {
					userId: getCurrentUserId(),
					products: cart,
					paymentMethod: selectedPayment,
					totalAmount: cart.reduce((sum, item) => sum + item.finalprice * item.quantity, 0),
					orderDate: new Date().toISOString(),
					status: 'pending'
				};

				// Save order to database
				saveOrder(order);
			}

			// Save order to database
			function saveOrder(order) {
				const user = getCurrentUser();
				if (user) {
					if (!user.orders) {
						user.orders = [];
					}
					user.orders.push(order);
					setCurrentUser(user);
					
					// Clear cart after successful order
					user.cartItems = [];
					setCurrentUser(user);
					
					showCustomAlert('Order placed successfully!', 'success');
					setTimeout(() => {
						window.location.href = 'order-history.html';
					}, 2000);
				}
			}

			// Generate product image based on type
			function getProductImage(productType, productName='') {
				if (productType === "CPU") {
					return "cpu.png";
				} else if (productType === "GPU") {
					return "gpu.png";
				} else if (productType === "RAM") {
					return "ram.png";
				} else if (productType === "Device") {
					return "shop01.png";
				} else if (productType === "Storage") {
					if (productName.toLowerCase().includes("ssd")) {
						return "ssd.png";
					} 
					else  {
						return "hdd.png";
					}
				} else {
					return "default.png";
				}
			}

			// Update quantity function
			function updateQuantity(productId, newQuantity) {
				if (newQuantity < 1) {
					removeFromCart(productId);
					return;
				}
				
				const cart = getCart();
				const item = cart.find(item => item.productId === productId);
				if (item) {
					item.quantity = newQuantity;
					saveCart(cart);
					loadCheckoutCart();
				}
			}

			// Display current user information
			function displayCurrentUserInfo() {
				const user = getCurrentUser();
				if (!user) {
					return null;
				}
				
				// Extract relevant fields following the user object structure
				const userInfo = {
					id: user.id,
					email: user.email,
					userName: user.userName,
					role: user.role,
					phone: user.phone,
					address: user.address,
					createdAt: user.createdAt,
					wishlist: user.wishlist || [],
					cartItems: user.cartItems || []
				};
				
				return userInfo;
			}

			// Initialize checkout page
			document.addEventListener('DOMContentLoaded', function() {
				try {
					// Check if required functions are available
					if (typeof getCurrentUserId === 'undefined') {
						return;
					}
					if (typeof getCurrentUser === 'undefined') {
						return;
					}
					if (typeof updateAuthLink === 'undefined') {
						return;
					}
					
					// Update authentication link
					updateAuthLink('checkout');
					
					// Check if user is logged in
					const userId = getCurrentUserId();
					
					if (!userId) {
						showCustomAlert('Please log in to access checkout!', 'error');
						setTimeout(() => {
							window.location.href = 'login.html?returnUrl=' + encodeURIComponent(window.location.pathname);
						}, 2000);
						return;
					}

					// Display current user information
					displayCurrentUserInfo();

					// Load cart items
					loadCheckoutCart();
					
					// Update cart and wishlist counts
					updateCartCount();
					updateWishlistCount();
					
				} catch (error) {
					// Handle errors silently
				}
			});

			function populateUserInfo() {
				const user = getCurrentUser();
				if (user) {
					$('#user-name').val(user.userName);
					$('#user-email').val(user.email);
					$('#user-phone').val(user.phone);
					$('#user-address').val(user.address);
					// $('#user-notes').val(user.notes);

					
				}
			}

			$(document).ready(function() {
				// Fallback initialization if DOMContentLoaded didn't work
				const container = document.getElementById('checkout-cart-items');
				if (container && container.children.length === 0) {
					try {
						updateAuthLink('checkout');
						const userId = getCurrentUserId();
						if (userId) {
							loadCheckoutCart();
							updateCartCount();
							updateWishlistCount();
							populateUserInfo();
						}
					} catch (error) {
						// Handle errors silently
					}
				}
			});
		</script>

	</body>

</html>